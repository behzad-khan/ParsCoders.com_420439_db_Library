-- Drop all procedures
declare @cmd nvarchar(1000)
declare cmds cursor for
select 'drop procedure ['+name+']' from db_Library.sys.procedures where is_ms_shipped = 0
open cmds
while 1=1
begin
	fetch cmds into @cmd
	if @@FETCH_STATUS!=0 break;
	EXEC (@cmd);
end
close cmds;
deallocate cmds;

use db_Library

GO

-- • ????? ?? ?????? ?? ?????? ?? ?????? ???? ? ?? ? ????? ?? ?? ????? ?????? Insert ??? . 
create procedure sp_InsertStaff(
	@Name nvarchar(150),
	@Family nvarchar(150),
	@PhoneNo varchar(20) = null,
	@Email varchar(150) = null,
	@Address nvarchar(4000) = null
)
as
Begin
	declare @OutputTbl table(Id int)
	insert into People
	([Name], Family, PhoneNo, Email, [Address])
	output inserted.PersonId into @OutputTbl(Id)
	Values
	(@Name, @Family, @PhoneNo, @Email, @Address)
	declare @Id int
	select @Id=Id from @OutputTbl
	insert into Staffs
	(StaffId) Values (@Id)
End

GO

-- ???? ? ?? ????? ?? ??????? ?? ?????? ???? ? ? ?????? ?? ?? ? ??? ?????? ??????? ? ? ??? ???? ??? 
-- ?? ?? ?????? ???? ??? ???. 
create procedure sp_DeleteAuther(@AutherId int)
AS
Begin
	delete AutherBookCopies where AutherId = @AutherId
	delete Authers where AutherId = @AutherId
End

GO

-- • ????? ?? ????? ?? ???? ?? ?????? ??? ? ??? ???? ????????? ?? ??? ? ?? ?? ? ???? print ??? ???. 
create procedure sp_PrintAllBookAuthers(@ISBN varchar(100))
AS
Begin
	declare @Name nvarchar(300), @Family nvarchar(300)
	declare cmds cursor for
	select p.Name, p.Family 
	from AutherBookCopies ab
	join People p on p.PersonId = ab.AutherId
	join BookCopies bc on bc.ISBN =ab.ISBN
	where bc.ISBN = @ISBN
	open cmds
	while 1=1
	begin
		fetch cmds into @Name,@family
		if @@FETCH_STATUS!=0 break
		print(@Name+ ' ' + @Family)
	end
	close cmds
	deallocate cmds
End

